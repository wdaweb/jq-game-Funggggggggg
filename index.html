<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>jQ game åƒé­š</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            width: 100%;
            height: 100%;
            font-weight: 400;
            font-style: bold;
            /* background:linear-gradient(rgba(185, 255, 45, 0.3),rgb(0, 23, 47)); */
            background:linear-gradient(to bottom,rgba(185, 255, 45, 0.3) 0%,rgba(15, 112, 144, 0.668) 20%,rgb(0, 61, 75) 60%,rgb(0, 23, 47) 80%);
        }
        
        .container {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100vw;
            height: 100vh;
        }

        #particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
        }
        
        .layout {
            width: 300px;
            height: 550px;
            margin-right: 50px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            font-size: 12px;
            color: lightgoldenrodyellow;
            background:url(./pictures/candleFeet.png)no-repeat center;
            background-size: 135%;
            z-index: 2;
        }
        .layout p {
            margin-bottom: 10px;
        }

        #game {
            width: 750px;
            height: 500px;
            background:rgba(197, 225, 255, 0.2);
            /* filter: blur(5px); */
            border-radius: 40px;
            position: relative;
            overflow: hidden;
            cursor: url(./pictures/mouth00.png) 42 30, auto;
            /* box-shadow: 0px 0px 35px inset rgba(255, 255, 228, 0.2); */
            box-shadow: 0px 0px 40px rgba(255, 255, 228, 0.4),0px 0px 30px inset rgba(255, 255, 228, 0.3);
        }
        #game:hover {
            box-shadow: 0px 0px 55px rgba(255, 255, 228, 0.4),0px 0px 40px inset rgba(255, 255, 228, 0.4);
        }
        #game:active {
            cursor: url(./pictures/mouth001.png) 42 30, auto;
        }

        #game img {
            position: absolute;
            /*  user-select: none â†’ ç¦æ­¢é¸å–æ–‡å­—ã€‚ 
                -webkit(ç¶²è·¯å·¥å…·åŒ…)-user-drag(æ‹–æ›³): none; â†’ ç¦æ­¢æ‹–æ›³å…ƒç´ ï¼ˆä¸»è¦æ˜¯åœ–ç‰‡ï¼‰ã€‚*/
            user-select: none; 
            -webkit-user-drag: none;
        }

        .target {
            /* è®“é­šçš„åœ–å±¤å¾€ä¸Šæ”¾ */
            z-index: 3;
        }

        .bone {
            /* æœƒè“‹åˆ°é­š => å¿½ç•¥æ‰€æœ‰é»æ“Šäº‹ä»¶ */
            /* ç•¶ä¸€å€‹å…ƒç´ è¢«è¨­ç½®ç‚º pointer-events: none; æ™‚ï¼Œ
            è©²å…ƒç´ å°±åƒæ˜¯é€æ˜çš„(åœ–å±¤)ï¼Œç„¡è«–ç”¨æˆ¶å¦‚ä½•èˆ‡å…¶äº¤äº’ï¼Œéƒ½ä¸æœƒè§¸ç™¼ä»»ä½•äº‹ä»¶ã€‚ */
            /* æ³¨æ„ï¼šå®ƒä¸æœƒé˜»æ­¢å…¶ä»–äº‹ä»¶ï¼ˆå¦‚éµç›¤äº‹ä»¶ï¼‰ï¼Œåªæœƒå½±éŸ¿é¼ æ¨™ç›¸é—œçš„äº‹ä»¶ã€‚ */
            pointer-events: none;
            z-index: 0;
        }

        .extra {
            position: absolute;
            font-size: 18px;
            color: rgb(255, 247, 95);
            pointer-events: none;
            z-index: 10000;
            transition: all 0.3s ease; /* å¹³æ»‘éæ¸¡æ•ˆæœ */
        }
        #picSrc {
            position: absolute;
            width: 360px;
            height: 30px;
            bottom: 0px;
            right: 0px;
            font-size: 10px;
            color: lightgoldenrodyellow;
        }
    </style>
</head>

<body>
    <div class="container">
        <div id="particles-js" ></div>
            <div class="layout">
                <!-- <img  id="candleFeet" src="./pictures/candleFeet.png"> -->
                <input type="button" value="é–‹å§‹åƒé­š" id="btn-start" style="background-color: rgba(127, 255, 185, 0.049); color: lightgoldenrodyellow; padding: 5px 10px;">
                <br>
                <p>
                    åˆ†æ•¸: <span id="text-score">0</span>
                    <span>&nbsp &nbsp</span>
                    å‰©é¤˜æ™‚é–“: <span id="text-time">0</span>
                </p>
                <p>æœ€é«˜åˆ†ç©å®¶: <span id="text-highscore-player">-</span></p>
                <p>æœ€é«˜åˆ†æ•¸: <span id="text-highscore-score">-</span></p>
                <br>
                <br>
                <br>
                <br>
            </div>
            <div id="game"></div>
            <p id="picSrc">ä½œå“ä¾†æºï¼šhttps://www.instagram.com/fungfung_1995?igsh=am15aHV3ZjBsY2sw </p>
    </div>
    
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.js'
        integrity='sha512-+k1pnlgt4F1H8L7t3z95o3/KO+o78INEcXTbnoJQ/F2VqDVhWoaiVml/OEHv9HsVgxUaVW+IbiZPUJQfF/YxZw=='
        crossorigin='anonymous'></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        // å‘½åè¦å‰‡ => ä¸è®Šçš„ const è¨­å®šå€¼æœƒç”¨å¤§å¯«
        const GAMETIME = 30

        // åˆ†æ•¸
        let score = 0
        // å‰©é¤˜æ™‚é–“
        let timeLeft = 0
        // è¨ˆæ™‚å™¨
        let timer = 0
        // æœ€é«˜åˆ† => å­˜åœ¨ local storage ä¸­ï¼Œåªæ¥å—å­˜å„²å­—ä¸²ï¼ˆStringï¼‰
        // å› æ­¤åœ¨å„²å­˜æ™‚ï¼Œéœ€è¦å°‡ç‰©ä»¶ (Object) è½‰æ›ç‚ºå­—ä¸²ï¼Œä¸¦åœ¨å–å›æ™‚è½‰æ›å›ç‰©ä»¶ã€‚
        const highscore = {
            name: '-',
            score: 0
        }

        // è½‰æ›æœ€é«˜åˆ†ä½¿ç”¨è€…è³‡æ–™
        // if æ¢ä»¶ç”¨ä¾†æª¢æŸ¥è©² key æ˜¯å¦å­˜åœ¨ï¼š
        // å¦‚æœå­˜åœ¨ï¼šè¡¨ç¤ºå·²å­˜éé«˜åˆ†æ•¸æ“šï¼Œæ¥ä¸‹ä¾†åŸ·è¡Œæ•¸æ“šè®€å–èˆ‡é¡¯ç¤ºçš„ç¨‹å¼ã€‚
        // å¦‚æœä¸å­˜åœ¨ï¼šè·³éæ•´å€‹ if å€å¡Šï¼Œè¡¨ç¤ºé‚„æ²’æœ‰ä»»ä½•é«˜åˆ†æ•¸æ“šã€‚
        if (localStorage.fish) {
            // å°‡å­˜å„²çš„é«˜åˆ†æ•¸æ“šå–å‡ºä¸¦è§£æ
            // JSON.parse() å°‡ localStorage.fish (å­—ä¸²)è½‰æ›å›ç‰©ä»¶ã€‚
            const data = JSON.parse(localStorage.fish)
            // å°‡é€™äº›è§£æå‡ºçš„æ•¸æ“šåˆ†åˆ¥è³¦å€¼çµ¦ highscore ç‰©ä»¶ä¸­çš„ name å’Œ score å±¬æ€§
            highscore.name = data.name
            highscore.score = data.score
            $('#text-highscore-player').text(highscore.name)
            $('#text-highscore-score').text(highscore.score)
        }

        // é»æ“Šäº‹ä»¶å…§ç›¡é‡ä¸è¦åŒ…é»æ“Šäº‹ä»¶ï¼Œæœƒäº‚æ‰ã€‚
        $('#btn-start').click(function () {
            console.log(this)  //é€™é‚Šçš„ (this) æœƒæŒ‡åˆ° button

            // åœç”¨é–‹å§‹æŒ‰éˆ•
            // disabled æ˜¯ä¸€å€‹ HTML å…¨å±€å±¬æ€§
            // ç”¨æ–¼å°‡è¡¨å–®å…ƒç´ ï¼ˆå¦‚æŒ‰éˆ•ã€è¼¸å…¥æ¡†ç­‰ï¼‰è¨­ç½®ç‚ºã€Œä¸å¯ç”¨ã€ç‹€æ…‹ã€‚(å¦‚æŒ‰éˆ•ç„¡æ³•é»æ“Š/å…ƒç´ çš„å¤–è§€é¡¯ç¤ºç‚ºç°è‰²ç­‰)
            $(this).attr('disabled', true)
            // é‡è¨­
            score = 0
            $('#text-score').text(score)
            timeLeft = GAMETIME
            $('#text-time').text(timeLeft)

            // setInterval çš„ function çš„ this æ˜¯ window
            // æ‰€ä»¥å…ˆæŠŠé»æ“Šäº‹ä»¶çš„ this æ”¾åˆ°è®Šæ•¸è£¡é¢çµ¦å¾Œé¢ä½¿ç”¨
            const _this = this

            let currentFishIndex = 1; // åˆå§‹åŒ–ç´¢å¼•å€¼ï¼Œå¾ 1 é–‹å§‹

            //ğŸŸ¢ é–‹å§‹éŠæˆ²
            timer = setInterval(function () {
                // å€’æ•¸
                timeLeft--
                $('#text-time').text(timeLeft)

                // éš¨æ©Ÿæ•¸å­—ï¼Œéš¨æ©Ÿ >=5 ä¸”ç›®æ¨™æ•¸é‡ < 10 æ‰å‡ºç¾
                const random = Math.round(Math.random() * 10)
                console.log(random)
                
                // .target ä»£è¡¨æ–°å¢åˆ°éŠæˆ²ç•«é¢ä¸Šçš„æ¯ä¸€å€‹ç›®æ¨™ç‰©ä»¶ã€‚( html ä¸Šæ²’æœ‰çš„éš±è— class)
                // .length å–å¾—é€™äº›(.target çš„)å…ƒç´ æ•¸é‡ã€‚
                if (random >= 5 && $('.target').length < 15) {
                    // éš¨æ©Ÿæ±ºå®šä½ç½®
                    // ç•¶ä¹˜ä»¥ 100 æ™‚ï¼Œå°±æœƒç”Ÿæˆä¸€å€‹ç¯„åœ 0 åˆ° 100 çš„éš¨æ©Ÿæ•¸å­—ï¼Œè¡¨ç¤ºç™¾åˆ†æ¯”ã€‚
                    const top = Math.round(Math.random() * 90 + 5) + '%'
                    const left = Math.round(Math.random() * 90 + 5) + '%'
                    
                    const target = $(`<img src="./pictures/fish0${currentFishIndex}.png" class="target" style="top: ${top}; left:${left}">`)
                    
                    // æ¨¡æ•¸é‹ç®—çš„çµæœæ˜¯ 0~4ï¼Œæ•… + 1 è®“ç´¢å¼•å¾ªç’°åœ¨ 1~5 ä¹‹é–“
                    // Math.random() æœƒç”Ÿæˆä¸€å€‹ éš¨æ©Ÿçš„å°æ•¸ï¼Œé€™å€‹å°æ•¸çš„ç¯„åœæ˜¯ [0, 1)ï¼Œä¹Ÿå°±æ˜¯ï¼šæœ€å°å€¼æ˜¯ 0ï¼Œå¯èƒ½æœƒç”Ÿæˆ 0ï¼Œä½†ä¸åŒ…å« 1ã€‚æœ€å¤§å€¼æ¥è¿‘ 1ï¼Œä½†æ°¸é ä¸æœƒç­‰æ–¼ 1ã€‚
                    // Math.random() * 5 => [0, 5)
                    currentFishIndex = Math.floor(Math.random() * 5) + 1
                    console.log('é­š!!!',currentFishIndex)

                    // å°‡å‰›å‰›ç”Ÿæˆçš„ target (ç›®æ¨™åœ–ç‰‡) æ’å…¥åˆ°å®¹å™¨ä¸­ã€‚
                    $('#game').append(target)
                    // è¦è®“ç›®æ¨™ä¸€ç›´ç§»å‹• => éœ€è¦è¨­ç½®ä¸€å€‹ function ä¾†å•Ÿå‹• (move æ˜¯å‘½åå‡½å¼)
                    move(target)
                }
                // ğŸ”´ æ™‚é–“åˆ° å‰©é¤˜æ™‚é–“ = 0 
                if (timeLeft === 0) {
                    // è¨ˆæ™‚å™¨æ¸…é™¤
                    clearInterval(timer)
                    // âŒ console.log(this) => æœƒæŒ‡åˆ° window
                    // this è¦çœ‹ä¸Šä¸€å±¤çš„ function => æŒ‡å‘ setIntervalã€‚
                    // ä¿®æ”¹æ–¹æ³•ä¸€ï¼šå°‡ function æ”¹æˆç®­é ­å‡½å¼(æ²’æœ‰ this)
                    // ä¿®æ”¹æ–¹æ³•äºŒï¼šæŠŠé»æ“Šäº‹ä»¶çš„ this æ”¾åˆ°è®Šæ•¸ _thisè£¡é¢çµ¦å¾Œé¢ä½¿ç”¨ => const _this = this (ç¬¬ 94 è¡Œ)
                    console.log(_this) 
                    // é‡å•Ÿé–‹å§‹æŒ‰éˆ•
                    // å°‡æŒ‰éˆ•çš„ disabled(åœç”¨) å±¬æ€§è¨­ç‚º false
                    $(_this).attr('disabled', false)
                    // æ¸…ç©ºéŠæˆ²å€åŸŸ
                    $('#game').empty()

                    // ğŸ† æœ€é«˜åˆ†
                    // å¦‚æœæˆ‘çš„åˆ†æ•¸ > æœ€é«˜åˆ†çš„è©±
                    if (score > highscore.score) {
                        Swal.fire({
                            title: 'æœ€é«˜åˆ†',
                            text: 'text'
                        }).then(result => {
                            console.log(result)

                            // ä½¿ç”¨è€…è¼¸å…¥åå­—
                            const name = prompt('æœ€é«˜åˆ†') || 'ã‚ã‚ã‚ã‚ã‚'
                            // ä¿®æ”¹è®Šæ•¸ï¼šæœ€é«˜åˆ†çš„åå­—è·Ÿåˆ†æ•¸ï¼Œæ˜¯æˆ‘çš„åå­—åŠåˆ†æ•¸ => æ–‡å­—ä¹Ÿä¸€èµ·ä¿®æ”¹
                            highscore.name = name
                            highscore.score = score

                            $('#text-highscore-player').text(highscore.name)
                            $('#text-highscore-score').text(highscore.score)

                            // â­ å°‡è³‡æ–™æ”¾é€² local storage
                            // æ–¹æ³•ä¸€ï¼šlocalStorage.setItem(è³‡æ–™åç¨±, æ–‡å­—)
                            // æ–¹æ³•äºŒï¼šlocalStorage.è³‡æ–™åç¨± = æ–‡å­—

                            // JSON.stringify => å°‡é™£åˆ—æˆ–ç‰©ä»¶è½‰æˆæ–‡å­— 
                            // JSON.parse => å°‡æ–‡å­—è½‰å›é™£åˆ—æˆ–ç‰©ä»¶
                            localStorage.fish = JSON.stringify(highscore)
                            // F12 è©¦ä¸€ä¸‹
                            // JSON.stringify(highscore) => '{"name":"ppp","score":7}'
                            // JSON.parse('{"name":"ppp","score":7}') => {name:'_',score:0}
                        })
                    } else {
                        Swal.fire({
                            title: 'æ™‚é–“åˆ°',
                            text: `åˆ†æ•¸: ${score}`
                        })
                    }
                }
            }, 1000)
        })


        // ğŸ¯ æ»‘é¼ é»æ“Šäº‹ä»¶ 
        // å› ç‚º target æ˜¯å¾Œä¾†ç”¢ç”Ÿçš„ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥ç”¨ $('.target').click()å»å– âŒ
        $('#game').on('click', '.target', function () {
            console.log('1234')
            // å…ˆåœæ­¢å‹•ç•« => æ›åœ–ç‰‡ => æŠŠ class æ‹¿æ‰ => å†åŠ  class => åˆ†æ•¸ ++ã€æ”¹åˆ†æ•¸åŠæ–‡å­—
            $(this).stop()
            const originalSrc = $(this).attr('src'); // åœ¨æ›´æ–°åœ–ç‰‡å‰ï¼Œå…ˆå­˜ä¸‹åŸå§‹åœ–ç‰‡è·¯å¾‘
            const isNegative = originalSrc.includes('fish05.png');

            $(this).attr('src', './pictures/fishBone.png')
            $(this).removeClass('target').addClass('bone')
            console.log('åœ–ç‰‡æ›´æ–°ç‚º:', $(this).attr('src'), 'ç›®å‰ class:', $(this).attr('class'));

            // åˆ†æ•¸æç¤º
            const text = isNegative ? '-3' : '+1'; // æ±ºå®šæ–‡å­—å…§å®¹
            const color = isNegative ? 'red' : 'yellow'; // æ±ºå®šæ–‡å­—é¡è‰²
            const scoreHint = $(`<p class="extra" style="color: ${color}">${text}</p>`); // å»ºç«‹ <p> å…ƒç´ 
            $('#game').append(scoreHint); // åŠ å…¥åˆ°éŠæˆ²å€åŸŸ
            
            // ç²å–é­šçš„ä½ç½®
            const offset = $(this).offset(); 
            if(!offset) {
                console.error('ç„¡æ³•å–å¾—ç›®æ¨™å…ƒç´ çš„ä½ç½®ä¿¡æ¯ï¼š', $(this));
                return;
            }
            // console.log('ç›®æ¨™ä½ç½®:', offset);
            
            scoreHint.css({
                // éœæ…‹å±¬æ€§å¯æ”¾åœ¨ style ä¸­
                position: 'absolute',
                // top: offset.top,
                // left:offset.left,
                top: offset.top -95,
                left:offset.left -380,
                // right: offset.right +100,
            });

            scoreHint.animate(
                { top: offset.top - 100, opacity: 0 }, // å‘ä¸Šç§»å‹•ä¸¦æ·¡å‡º
                1000,
                function () {
                    // console.log('å‹•ç•«å®Œæˆï¼Œç§»é™¤æç¤ºå…ƒç´ ');
                    scoreHint.remove(); // çµæŸå¾Œæ¸…é™¤
                }
            );
            // æ›´æ–°åˆ†æ•¸
            if (isNegative) {
                score -= 3;
            } else {
                score++;
            }
            $('#text-score').text(score);
        })
        
        // ä¸æ–·çš„éš¨æ©Ÿæ±ºå®šç›®æ¨™ç§»å‹•ä½ç½®
        function move(target) {
            // è¤‡è£½ä¸Šé¢éš¨æ©Ÿç§»å‹•è¦å‰‡
            const top = Math.round(Math.random() * 100) + '%'
            const left = Math.round(Math.random() * 100) + '%'
            // animate() æ˜¯ jQ å…§å»ºå‡½æ•¸ï¼Œå…¶ä¸»è¦åŠŸèƒ½æ˜¯é€éã€Œæ¼¸è®Šã€ä¾†æ”¹è®Šå…ƒç´ çš„ CSS å±¬æ€§å€¼ï¼Œé€²è€Œé”åˆ°å‹•ç•«æ•ˆæœã€‚
            // å…¶æ ¸å¿ƒä½œç”¨æ˜¯è®“ç›®æ¨™å…ƒç´ å¹³æ»‘åœ°æ”¹è®Šå…¶ CSS å±¬æ€§å€¼ï¼Œ
            // èªæ³•: .animate (properties å±¬æ€§, duration éç¨‹, complete ä½¿å®Œæ•´)
            // propertiesï¼ˆç¬¬ä¸€å€‹åƒæ•¸ï¼‰å®šç¾©å…ƒç´ åœ¨å‹•ç•«çµæŸå¾Œçš„ç›®æ¨™ CSS å±¬æ€§å€¼ã€‚
            // durationï¼ˆç¬¬äºŒå€‹åƒæ•¸ï¼‰å®šç¾©å‹•ç•«åŸ·è¡Œçš„æŒçºŒæ™‚é–“ï¼Œä»¥æ¯«ç§’ç‚ºå–®ä½ã€‚
            // completeï¼ˆç¬¬ä¸‰å€‹åƒæ•¸ï¼Œé¸å¡«ï¼‰ é€™æ˜¯ä¸€å€‹ å›å‘¼å‡½æ•¸ï¼Œé€šå¸¸ç”¨æ–¼å®šç¾©å‹•ç•«å®Œæˆå¾Œçš„å¾ŒçºŒè¡Œç‚ºã€‚
            target.animate({ top, left }, 1000, function () {
                move(target)
                // è®“ target ç§»å‹•åˆ°éš¨æ©Ÿçš„åº§æ¨™ï¼Œç”¨ 2 ç§’é˜ï¼Œç§»å‹•å®Œå¾Œå†å‘¼å«ä¸€æ¬¡åç‚º move çš„ function å†å‹•ä¸€æ¬¡
            })
        }
    </script>
    <script src="./particles.js/particles.min.js"></script>
    <script src="./particles.js/particles_app.js"></script>
</body>

</html>